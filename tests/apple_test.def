include: std_ios.def
include: ios_cg.def

page: test
    subcode: main
	# Non-GUI functions and declarations here
	# The Model part of MVP also may go here
	$subclass AppDelegate
	    $prop(strong,nonatomic) UIWindow * window
	    $method on_start
		self.window=new UIWindow
		self.window.backgroundColor = [UIColor whiteColor]
		$call on_start
		self.window->makeKeyAndVisible
		return YES
	    $method on_finish
		$call @on_finish
	$list n_main

    fncode: n_main
	@autoreleasepool {
	    return UIApplicationMain(argc, argv, nil, @"AppDelegate")
	}

    subcode: on_start
	$MakeController main
	self.window->addSubview controller.view
	    
#### GUI Part ########################################

# ---- Controller part for main window -----------------
subcode: main_on_draw
    $call g_font, Times New Roman, 16
    $call g_moveto, 10, 10
    $local s_buffer[20]
    n=sprintf(s_buffer, "Clicked %d times", n_clicked)
    $call g_set_gray_fill, 0.2
    $call g_text, s_buffer, n

subcode: main_on_click
    n_clicked++
    [self setNeedsDisplay]

# ---- View part for main window -----------------------
resource: view_main
    position: 0, 0
    size: -0, -0
    property: n_clicked=0
    background_color: ffffff
    label
	text: Hello World!
	position: 5, 100
	size: 200, 20
    button
	text: push me
	position: 5, 200
	size: 80, 40
	action: on_click
    
resource: font_main
    name: Times New Roman
    size: 16
