subcode: parsecode_for_support(style)
    $if $param=~/(.*);(.*);(.*)/
        &call return_newblock, for
            $(set:type=asis)
            $call for_$(style)
    $else
        my $var
        $if $param=~/^(\S+)\s*=\s*(.*)/
            $var=$1
            $param=$2
        my @tlist=split /:/, $param
        my ($i0, $i1, $step)
        $call parsecode_for_convention
        $call @for_i0_i1_step
        &call return_newblock, for
            $(set:type=i0_i1_step)
            $call for_$(style)

#---------------------------------------- 
subcode: parsecode_for_convention
    $if @tlist==1
        $i0="0"
        $i1="<$param"
        $step="1"
    $elif @tlist==2
        $if $tlist[1] eq "0"
            # CAUTION
            #   $i=n:0 be the reverse of $i=0:n
            $i0="$tlist[0]-1"
            $i1=">=$tlist[1]"
            $step="-1"
        $else
            # $for i0:i1
            $i0=$tlist[0]
            $i1="<$tlist[1]"
            $step="1"
    $elif @tlist==3
        $i0=$tlist[0]
        $step=$tlist[2]
        $if $step=~/^-/
            # Counting down is not zero based
            $i1=">=$tlist[1]"
        $else
            # we're used to zero based counting up
            $i1="<$tlist[1]"

#---------------------------------------- 
subcode: parsecode_while_support(style)
    my ($init, $cond, $next)

    my @clause = split /\s*;\s*/, $param
    my $n = @clause
    $if !$clause[-1]
        $n--

    $if $n>3
        $call warn, "error: [\$while $param]\n"
    $elif $n==3
        ($init, $cond, $next) = @clause
    $elif $n==2
        ($cond, $next) = @clause
    $elif $n==1
        $cond = $param
    $else
        $cond = 1

    &call return_newblock, while
        $call while_$(style)

#---------------------------------------- 
subcode:@ for_c_style
    $call push_single_block, "for($param){", "}"

subcode: while_c_style
    $if $cond
        push @src, "$init;"
    push @src, "while($cond){"
    push @src, "INDENT"
    push @src, "BLOCK"
    $if $next
        push @src, "$next;"
    push @src, "DEDENT"
    push @src, "}"

subcode:@ for_i0_i1_step
    $param="$var=$i0; $var$i1; $var+=$step"
    print "Provide \"subcode: for_i0_i1_step \" to support \$for\n"

