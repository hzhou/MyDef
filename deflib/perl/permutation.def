subcode: permute(n, k)
    my @perm
    $for $i=0:$(n)
        $perm[$i]=$i
    $call reverse_tail, $(k)

    $while 1
        BLOCK
        $call permute_inc

    subcode: permute_inc
        &call find_tail_descending
            $call swap_least_bigger
            $call reverse_tail, $i+1
            $call reverse_tail, $(k)

    subcode: find_tail_descending
        my $max=-1
        my $i=$(n)-1
        $while $i>=0
            $if $max < $perm[$i]
                $max = $perm[$i]
            $else
                break
            $i--
        $if $i<0
            break
        $else
            BLOCK

    subcode: swap_least_bigger
        $for $j=$(n):0
            $if $perm[$j]>$perm[$i]
                $call swap, $perm[$j], $perm[$i]
                break

    subcode: reverse_tail(lead)
        $(if:k!=$(n))
            my $j=$(lead)
            my $k=$(n)-1
            $while $j<$k
                $call swap, $perm[$j], $perm[$k]
                $j++
                $k--

    subcode: swap(a, b)
        my $_t = $(a)
        $(a) = $(b)
        $(b) = $_t

